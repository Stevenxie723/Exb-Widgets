System.register(["jimu-core","jimu-core/react"],(function(e,t){var n={},r={};return{setters:[function(e){n.DataSourceComponent=e.DataSourceComponent,n.DataSourceManager=e.DataSourceManager,n.JimuFieldType=e.JimuFieldType,n.React=e.React,n.classNames=e.classNames,n.css=e.css,n.jsx=e.jsx},function(e){r.useCallback=e.useCallback,r.useEffect=e.useEffect,r.useState=e.useState}],execute:function(){e((()=>{var e={7568:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M11.347 2.146a.485.485 0 0 1 0 .708L5.76 8l5.587 5.146a.486.486 0 0 1 0 .708.54.54 0 0 1-.738 0l-5.956-5.5a.485.485 0 0 1 0-.708l5.956-5.5a.54.54 0 0 1 .738 0" clip-rule="evenodd"></path></svg>'},2943:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M4.653 13.854a.485.485 0 0 1 0-.708L10.24 8 4.653 2.854a.485.485 0 0 1 0-.708.54.54 0 0 1 .738 0l5.956 5.5a.485.485 0 0 1 0 .708l-5.956 5.5a.54.54 0 0 1-.738 0" clip-rule="evenodd"></path></svg>'},9244:e=>{"use strict";e.exports=n},8972:e=>{"use strict";e.exports=r}},t={};function i(n){var r=t[n];if(void 0!==r)return r.exports;var o=t[n]={exports:{}};return e[n](o,o.exports,i),o.exports}i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.p="";var o={};return i.p=window.jimuConfig.baseUrl,(()=>{"use strict";i.r(o),i.d(o,{__set_webpack_public_path__:()=>C,default:()=>F});var e=i(9244),t=i(8972),n=i(7568),r=i.n(n),a=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const s=t=>{const n=window.SVG,{className:i}=t,o=a(t,["className"]),s=(0,e.classNames)("jimu-icon jimu-icon-component",i);return n?e.React.createElement(n,Object.assign({className:s,src:r()},o)):e.React.createElement("svg",Object.assign({className:s},o))};var c=i(2943),u=i.n(c),l=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const d=t=>{const n=window.SVG,{className:r}=t,i=l(t,["className"]),o=(0,e.classNames)("jimu-icon jimu-icon-component",r);return n?e.React.createElement(n,Object.assign({className:o,src:u()},i)):e.React.createElement("svg",Object.assign({className:o},i))};var f=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))};class g{constructor(e){this.delay=e,this.timeoutId=null}execute(e){return f(this,void 0,void 0,(function*(){this.timeoutId&&clearTimeout(this.timeoutId),this.timeoutId=setTimeout((()=>f(this,void 0,void 0,(function*(){try{yield e()}catch(e){console.error("Error in debounced function:",e)}this.timeoutId=null}))),this.delay)}))}}const v=({useDataSources:n,children:r,onDataSourceInfoChange:i,onDataSourceStatusChange:o,onDataSourceCreated:a,useDebounceExecutor:s})=>{const[c]=(0,t.useState)(new g(300)),u=(0,t.useCallback)(((e,t)=>{s||void 0===s?c.execute((()=>{null==i||i(e,t)})):null==i||i(e,t)}),[s,c,i]),l=(0,t.useCallback)(((e,t)=>{s||void 0===s?c.execute((()=>{null==o||o(e,t)})):null==o||o(e,t)}),[s,c,o]),d=(0,t.useCallback)((()=>{let t=r;for(let r=0;r<n.length;r++)t=(0,e.jsx)(e.DataSourceComponent,{useDataSource:n[r],onDataSourceInfoChange:u,onDataSourceStatusChange:l,onDataSourceCreated:a},t);return t}),[r,n,u,l,a]),[f,v]=(0,t.useState)(null);return(0,t.useEffect)((()=>{n&&n.length>0?v(d()):v(r)}),[r,d,n]),f};var m=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))};const p=t=>t===e.JimuFieldType.Number?0:t===e.JimuFieldType.Date?(new Date).getUTCMilliseconds():"",h=t=>{const n=e.DataSourceManager.getInstance().getDataSource(t);return null!=n?n:void 0},y=(e,t)=>{var n;try{const r=null===(n=null==t?void 0:t.getSchema())||void 0===n?void 0:n.fields;if(r){for(const[,t]of Object.entries(r))if(t.alias===e)return[t.name,t.type];for(const[,t]of Object.entries(r))if(t.name===e)return[t.name,t.type]}return[void 0,void 0]}catch(e){return[void 0,void 0]}},b=e=>{let t=0;for(let n=0;n<e.length;n++)if(","===e[n]){if(1===t)return n}else"("===e[n]?t++:")"===e[n]&&t--;return-1},S=(t,n,r,i,o)=>m(void 0,void 0,void 0,(function*(){const a=parseFloat(t);if(!isNaN(a))return a;try{const a=t.substring(0,t.indexOf("("));if(["count","sum","min","max","avg","stddev","var","percentile_cont","percentile_disc"].includes(a)){const e=t.substring(t.indexOf("(")+1,t.indexOf(")")),r=void 0!==n?h(n[void 0!==o?o:0]):void 0;return yield((e,t,n)=>m(void 0,void 0,void 0,(function*(){const[r,i]=y(e,n);try{if(["count","sum","min","max","avg","stddev","var","percentile_cont","percentile_disc"].includes(t)){const e=(yield n.query({outStatistics:[{onStatisticField:r,outStatisticFieldName:"value",statisticType:t}]})).records[0].getFieldValue("value");return null==e?p(i):e}return console.error("Invalid aggregation function:",t),p(i)}catch(e){return console.error("Error fetching or aggregating data:",e),p(i)}})))(e,a,r)}return(e=>/^add\(.+\,.+\)$/.test(e)||/^sub\(.+\,.+\)$/.test(e)||/^mul\(.+\,.+\)$/.test(e)||/^div\(.+\,.+\)$/.test(e))(t)?yield((t,n,r,i,o)=>m(void 0,void 0,void 0,(function*(){try{const a=b(t),s=t.substring(0,t.indexOf("(")),c=t.substring(t.indexOf("(")+1,a),u=t.substring(a+1,t.length-1);let l=yield x(c,n,r,i,o),d=yield x(u,n,r,i,o);if("string"==typeof l&&(l=parseFloat(l)),"string"==typeof d&&(d=parseFloat(d)),isNaN(l)||isNaN(d))return p(e.JimuFieldType.Number);{let t=0;if("div"===s&&0===d)return p(e.JimuFieldType.Number);if("div"===s)t=l/d;else if("add"===s)t=l+d;else if("sub"===s)t=l-d;else{if("mul"!==s)return p(e.JimuFieldType.Number);t=l*d}return t}}catch(t){return console.error("Error dividing values:",t),p(e.JimuFieldType.Number)}})))(t,n,r,i,o):(e=>/^select\(.+\,.+\)$/.test(e))(t)?yield((t,n,r,i)=>m(void 0,void 0,void 0,(function*(){try{const o=b(t),a=parseFloat(t.substring(t.indexOf("(")+1,o));if(isNaN(a)||a<0||a>=n.length)return p(e.JimuFieldType.Number);const s=t.substring(o+1,t.length-1);return yield x(s,n,r,i,a)}catch(t){return console.error("Error selecting values:",t),p(e.JimuFieldType.Number)}})))(t,n,r,i):p(e.JimuFieldType.Number)}catch(t){return console.error("Error parsing function:",t),p(e.JimuFieldType.Number)}})),x=(t,n,r,i,o)=>m(void 0,void 0,void 0,(function*(){if((e=>/^.+\(.+\)$/.test(e))(t))return yield S(t,n,r,i,o);if((e=>/^\d+(\.\d+)?$/.test(e))(t))return parseFloat(t);try{const a=void 0!==n?h(n[void 0!==o?o:0]):void 0;return((t,n,r,i)=>{if(!n)return;let o=i?[i]:n.getSelectedRecords();const[a,s]=y(t,n);0===o.length&&(o=n.getRecords());try{if(!o||0===o.length||void 0===o[0]||null===o[0])return p(s);{const t=o[0].getFieldValue(a);if(null==t)return p(s);if(s!==e.JimuFieldType.Date)return s===e.JimuFieldType.Number?null!=t?t:p(s):t;{const e=new Date(t);if("toLocaleString"===r||void 0===r)return e.toLocaleString();if("toLocaleDateString"===r)return e.toLocaleDateString();if("toLocaleTimeString"===r)return e.toLocaleTimeString()}}}catch(e){return console.error("Error fetching data:",e),p(s)}})(t,a,r,i)}catch(t){return console.error("Error parsing function:",t),p(e.JimuFieldType.String)}})),j=(e,t,n,r,i,o,...a)=>m(void 0,[e,t,n,r,i,o,...a],void 0,(function*(e,t,n,r,i,o,a=!1,s){if(e.includes("[")&&e.includes("]")){const c=e.indexOf("["),u=e.indexOf("]"),l=e.substring(c+1,u),d=s?s[l]:void 0;return e.substring(0,c)+`${d}`+(yield j(e.substring(u+1),t,n,r,i,o,a,s))}if(e.includes("{")&&e.includes("}")){const s=e.indexOf("{"),c=e.indexOf("}"),u=yield x(e.substring(s+1,c),t,n,i);let l=`${u}`;return"number"!=typeof u||a||(l=u.toLocaleString(o,{minimumFractionDigits:r,maximumFractionDigits:r})),e.substring(0,s)+l+(yield j(e.substring(c+1),t,n,r,i))}return e}));var w=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))};const D=({imgUrls:n,objectFit:r})=>{const[i,o]=(0,t.useState)(0),a=(0,t.useCallback)((()=>{o((i+1)%n.length)}),[i,n]),c=(0,t.useCallback)((()=>{o((i-1+n.length)%n.length)}),[i,n]),u=e.css`
    width: 30px;
    height: 30px;
    border-top-left-radius: 50%;
    border-top-right-radius: 50%;
    border-bottom-right-radius: 50%;
    border-bottom-left-radius: 50%;
    align-items: center;
    display: flex;
    justify-content: center;
    background-color: rgba(255, 255, 255, 0.5);
  `;return 0===n.length?(0,e.jsx)("div",{style:{width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center"}}):(0,e.jsx)("div",{style:{width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center"}},(0,e.jsx)("img",{src:n[i],style:{width:"100%",height:"100%",objectFit:null!=r?r:"contain"}}),n.length>1&&0!==i&&(0,e.jsx)("div",{style:{position:"absolute",top:0,left:0,width:"40%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center"},onClick:c},(0,e.jsx)("div",{css:u},(0,e.jsx)(s,{size:"15px"}))),n.length>1&&i!==n.length-1&&(0,e.jsx)("div",{style:{position:"absolute",top:0,right:0,width:"40%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center"},onClick:a},(0,e.jsx)("div",{css:u},(0,e.jsx)(d,{size:"15px"}))))},O=t=>{const n=e.DataSourceManager.getInstance().getDataSource(t);return null!=n?n:void 0},N=(e,t,n)=>w(void 0,void 0,void 0,(function*(){if(void 0===e.url||null===e.url)return[];const r=`${e.url}/${t}/attachments?f=json`,i=yield fetch(r),o=yield i.json();if(i.ok){const r=[];for(const i of o.attachmentInfos)n?r.push(`${e.url}/${t}/attachments/${i.attachmentid}?w=${n}`):r.push(`${e.url}/${t}/attachments/${i.attachmentid}`);return r}return[]}));function F(n){const[r,i]=(0,t.useState)([]),[,o]=(0,t.useState)(""),a=(0,t.useCallback)((()=>w(this,void 0,void 0,(function*(){let e,t;if(void 0===n.repeatedDataSource||null===n.repeatedDataSource||Array.isArray(n.repeatedDataSource))if(n.useDataSources&&n.useDataSources.length>0){const r=n.useDataSources[0].dataSourceId;if(e=O(r),void 0!==e){const n=e.getSelectedRecords();t=n.length>0?n[0].getId():void 0}else t=void 0}else e=void 0,t=void 0;else o(`Data source: ${null===n.repeatedDataSource}`),e=O(n.repeatedDataSource.dataSourceId),t=n.repeatedDataSource.record.getId();if(null==e||void 0===t)return void o(`Datasource is not avaiable? ${null==e}, object id is not avaiable? ${void 0===t}`);o(`Data source: ${e.url}, object id: ${t}`);const r=yield N(e,t,n.config.attachmentSetWidth);i(r)}))),[n.repeatedDataSource,n.config.attachmentSetWidth,n.useDataSources]),[s]=(0,t.useState)(void 0),c=(0,t.useCallback)((e=>w(this,void 0,void 0,(function*(){j(e,void 0,void 0,void 0,void 0,void 0,!1,s).then((e=>{i([e])}))}))),[s]),u=(0,t.useCallback)((()=>{"attachment"===n.config.source?a():c(n.config.imgUrl)}),[a,c,n.config.imgUrl,n.config.source]);return(0,t.useEffect)((()=>{u()}),[u]),(0,e.jsx)(v,{useDataSources:n.useDataSources,onDataSourceInfoChange:u,useDebounceExecutor:!1},(0,e.jsx)("div",{style:{width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center"}},(0,e.jsx)(D,{imgUrls:r,objectFit:n.config.objectFit})))}function C(e){i.p=e}})(),o})())}}}));