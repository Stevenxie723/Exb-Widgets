System.register(["jimu-core","jimu-core/react","jimu-ui"],(function(e,t){var n={},i={},o={};return{setters:[function(e){n.DataSourceComponent=e.DataSourceComponent,n.DataSourceManager=e.DataSourceManager,n.JimuFieldType=e.JimuFieldType,n.css=e.css,n.jsx=e.jsx},function(e){i.useCallback=e.useCallback,i.useEffect=e.useEffect,i.useState=e.useState},function(e){o.FontFamilyValue=e.FontFamilyValue}],execute:function(){e((()=>{var e={9244:e=>{"use strict";e.exports=n},8972:e=>{"use strict";e.exports=i},4321:e=>{"use strict";e.exports=o}},t={};function r(n){var i=t[n];if(void 0!==i)return i.exports;var o=t[n]={exports:{}};return e[n](o,o.exports,r),o.exports}r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.p="";var u={};return r.p=window.jimuConfig.baseUrl,(()=>{"use strict";r.r(u),r.d(u,{__set_webpack_public_path__:()=>S,default:()=>p});var e=r(9244),t=r(8972),n=r(4321),i=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function u(e){try{c(i.next(e))}catch(e){r(e)}}function s(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(u,s)}c((i=i.apply(e,t||[])).next())}))};const o=t=>t===e.JimuFieldType.Number?0:t===e.JimuFieldType.Date?(new Date).getUTCMilliseconds():"",s=t=>{const n=e.DataSourceManager.getInstance().getDataSource(t);return null!=n?n:void 0},c=(e,t)=>{var n;try{const i=null===(n=null==t?void 0:t.getSchema())||void 0===n?void 0:n.fields;if(i){for(const[,t]of Object.entries(i))if(t.alias===e)return[t.name,t.type];for(const[,t]of Object.entries(i))if(t.name===e)return[t.name,t.type]}return[void 0,void 0]}catch(e){return[void 0,void 0]}},a=e=>{let t=0;for(let n=0;n<e.length;n++)if(","===e[n]){if(1===t)return n}else"("===e[n]?t++:")"===e[n]&&t--;return-1},l=(t,n,r,u,l)=>i(void 0,void 0,void 0,(function*(){const f=parseFloat(t);if(!isNaN(f))return f;try{const f=t.substring(0,t.indexOf("("));if(["count","sum","min","max","avg","stddev","var","percentile_cont","percentile_disc"].includes(f)){const e=t.substring(t.indexOf("(")+1,t.indexOf(")")),r=void 0!==n?s(n[void 0!==l?l:0]):void 0;return yield((e,t,n)=>i(void 0,void 0,void 0,(function*(){const[i,r]=c(e,n);try{if(["count","sum","min","max","avg","stddev","var","percentile_cont","percentile_disc"].includes(t)){const e=(yield n.query({outStatistics:[{onStatisticField:i,outStatisticFieldName:"value",statisticType:t}]})).records[0].getFieldValue("value");return null==e?o(r):e}return console.error("Invalid aggregation function:",t),o(r)}catch(e){return console.error("Error fetching or aggregating data:",e),o(r)}})))(e,f,r)}return(e=>/^add\(.+\,.+\)$/.test(e)||/^sub\(.+\,.+\)$/.test(e)||/^mul\(.+\,.+\)$/.test(e)||/^div\(.+\,.+\)$/.test(e))(t)?yield((t,n,r,u,s)=>i(void 0,void 0,void 0,(function*(){try{const i=a(t),c=t.substring(0,t.indexOf("(")),l=t.substring(t.indexOf("(")+1,i),f=t.substring(i+1,t.length-1);let g=yield d(l,n,r,u,s),v=yield d(f,n,r,u,s);if("string"==typeof g&&(g=parseFloat(g)),"string"==typeof v&&(v=parseFloat(v)),isNaN(g)||isNaN(v))return o(e.JimuFieldType.Number);{let t=0;if("div"===c&&0===v)return o(e.JimuFieldType.Number);if("div"===c)t=g/v;else if("add"===c)t=g+v;else if("sub"===c)t=g-v;else{if("mul"!==c)return o(e.JimuFieldType.Number);t=g*v}return t}}catch(t){return console.error("Error dividing values:",t),o(e.JimuFieldType.Number)}})))(t,n,r,u,l):(e=>/^select\(.+\,.+\)$/.test(e))(t)?yield((t,n,r,u)=>i(void 0,void 0,void 0,(function*(){try{const i=a(t),s=parseFloat(t.substring(t.indexOf("(")+1,i));if(isNaN(s)||s<0||s>=n.length)return o(e.JimuFieldType.Number);const c=t.substring(i+1,t.length-1);return yield d(c,n,r,u,s)}catch(t){return console.error("Error selecting values:",t),o(e.JimuFieldType.Number)}})))(t,n,r,u):o(e.JimuFieldType.Number)}catch(t){return console.error("Error parsing function:",t),o(e.JimuFieldType.Number)}})),d=(t,n,r,u,a)=>i(void 0,void 0,void 0,(function*(){if((e=>/^.+\(.+\)$/.test(e))(t))return yield l(t,n,r,u,a);if((e=>/^\d+(\.\d+)?$/.test(e))(t))return parseFloat(t);try{const i=void 0!==n?s(n[void 0!==a?a:0]):void 0;return((t,n,i,r)=>{if(!n)return;let u=r?[r]:n.getSelectedRecords();const[s,a]=c(t,n);0===u.length&&(u=n.getRecords());try{if(!u||0===u.length||void 0===u[0]||null===u[0])return o(a);{const t=u[0].getFieldValue(s);if(null==t)return o(a);if(a!==e.JimuFieldType.Date)return a===e.JimuFieldType.Number?null!=t?t:o(a):t;{const e=new Date(t);if("toLocaleString"===i||void 0===i)return e.toLocaleString();if("toLocaleDateString"===i)return e.toLocaleDateString();if("toLocaleTimeString"===i)return e.toLocaleTimeString()}}}catch(e){return console.error("Error fetching data:",e),o(a)}})(t,i,r,u)}catch(t){return console.error("Error parsing function:",t),o(e.JimuFieldType.String)}})),f=(e,t,n,o,r,u,...s)=>i(void 0,[e,t,n,o,r,u,...s],void 0,(function*(e,t,n,i,o,r,u=!1,s){if(e.includes("[")&&e.includes("]")){const c=e.indexOf("["),a=e.indexOf("]"),l=e.substring(c+1,a),d=s?s[l]:void 0;return e.substring(0,c)+`${d}`+(yield f(e.substring(a+1),t,n,i,o,r,u,s))}if(e.includes("{")&&e.includes("}")){const s=e.indexOf("{"),c=e.indexOf("}"),a=yield d(e.substring(s+1,c),t,n,o);let l=`${a}`;return"number"!=typeof a||u||(l=a.toLocaleString(r,{minimumFractionDigits:i,maximumFractionDigits:i})),e.substring(0,s)+l+(yield f(e.substring(c+1),t,n,i,o))}return e}));var g=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function u(e){try{c(i.next(e))}catch(e){r(e)}}function s(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(u,s)}c((i=i.apply(e,t||[])).next())}))};class v{constructor(e){this.delay=e,this.timeoutId=null}execute(e){return g(this,void 0,void 0,(function*(){this.timeoutId&&clearTimeout(this.timeoutId),this.timeoutId=setTimeout((()=>g(this,void 0,void 0,(function*(){try{yield e()}catch(e){console.error("Error in debounced function:",e)}this.timeoutId=null}))),this.delay)}))}}const m=({useDataSources:n,children:i,onDataSourceInfoChange:o,onDataSourceStatusChange:r,onDataSourceCreated:u,useDebounceExecutor:s})=>{const[c]=(0,t.useState)(new v(300)),a=(0,t.useCallback)(((e,t)=>{s||void 0===s?c.execute((()=>{null==o||o(e,t)})):null==o||o(e,t)}),[s,c,o]),l=(0,t.useCallback)(((e,t)=>{s||void 0===s?c.execute((()=>{null==r||r(e,t)})):null==r||r(e,t)}),[s,c,r]),d=(0,t.useCallback)((()=>{let t=i;for(let i=0;i<n.length;i++)t=(0,e.jsx)(e.DataSourceComponent,{useDataSource:n[i],onDataSourceInfoChange:a,onDataSourceStatusChange:l,onDataSourceCreated:u},t);return t}),[i,n,a,l,u]),[f,g]=(0,t.useState)(null);return(0,t.useEffect)((()=>{n&&n.length>0?g(d()):g(i)}),[i,d,n]),f},y=(t,i,o,r,u,s,c)=>e.css`
    font-size: ${i};
    font-family: ${null!=t?t:n.FontFamilyValue.AVENIRNEXT};
    color: ${null!=o?o:"black"};
    font-weight: ${r?"bold":"normal"};
    font-style: ${u?"italic":"normal"};
    text-decoration-line: ${s&&c?"underline line-through":s?"underline":c?"line-through":"none"};
    padding: 0;
  `;function p(n){const i=e.css`
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
  `,o=y(n.config.firstLineFontFamily,n.config.firstLineFontSize,n.config.firstLineColor,n.config.firstLineBold,n.config.firstLineItalic,n.config.firstLineUnderline,n.config.firstLineStrike),r=y(n.config.secondLineFontFamily,n.config.secondLineFontSize,n.config.secondLineColor,n.config.secondLineBold,n.config.secondLineItalic,n.config.secondLineUnderline,n.config.secondLineStrike),[u,s]=(0,t.useState)(""),[c,a]=(0,t.useState)(""),[,l]=(0,t.useState)(""),[d]=(0,t.useState)(void 0),g=(0,t.useCallback)((()=>{var e,t;const i=void 0===n.useDataSources||null===n.useDataSources||0===n.useDataSources.length?void 0:Array.from(n.useDataSources.map((e=>e.dataSourceId))),o=f(null!==(e=n.config.firstLine)&&void 0!==e?e:"",i,void 0,n.config.numberRoundTo,void 0,n.config.locale,!1,d),r=f(null!==(t=n.config.secondLine)&&void 0!==t?t:"",i,void 0,n.config.numberRoundTo,void 0,n.config.locale,!1,d);Promise.all([o,r]).then((([e,t])=>{s(e),a(t)})).catch((e=>{l(e.message)}))}),[n.useDataSources,n.config.firstLine,n.config.numberRoundTo,n.config.locale,n.config.secondLine,d]);return(0,t.useEffect)((()=>{g()}),[g]),void 0===n.useDataSources||null===n.useDataSources||0===n.useDataSources.length?(0,e.jsx)("div",{style:{width:"100%",height:"100%"},css:i},(0,e.jsx)("div",{style:{textAlign:"center",alignItems:"center",flexWrap:"wrap"}},(0,e.jsx)("div",{css:o},u),(0,e.jsx)("div",{css:r},c))):(0,e.jsx)(m,{useDataSources:n.useDataSources,onDataSourceInfoChange:g},(0,e.jsx)("div",{className:"widget-get-map-coordinates jimu-widget p-2",css:i},(0,e.jsx)("div",{style:{textAlign:"center",flexWrap:"wrap"}},(0,e.jsx)("div",{css:o},u),(0,e.jsx)("div",{css:r},c))))}function S(e){r.p=e}})(),u})())}}}));