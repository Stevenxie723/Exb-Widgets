System.register(["jimu-core","jimu-core/react"],(function(e,t){var r={},i={};return{setters:[function(e){r.DataSourceManager=e.DataSourceManager,r.DataSourceStatus=e.DataSourceStatus,r.JimuFieldType=e.JimuFieldType,r.jsx=e.jsx},function(e){i.useCallback=e.useCallback,i.useEffect=e.useEffect,i.useState=e.useState}],execute:function(){e((()=>{var e={244:e=>{"use strict";e.exports=r},972:e=>{"use strict";e.exports=i}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var o=t[r]={exports:{}};return e[r](o,o.exports,n),o.exports}n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.p="";var o={};return n.p=window.jimuConfig.baseUrl,(()=>{"use strict";n.r(o),n.d(o,{__set_webpack_public_path__:()=>g,default:()=>v});var e=n(244),t=n(972),r=function(e,t,r,i){return new(r||(r=Promise))((function(n,o){function a(e){try{s(i.next(e))}catch(e){o(e)}}function u(e){try{s(i.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,u)}s((i=i.apply(e,t||[])).next())}))};const i=t=>t===e.JimuFieldType.Number?0:t===e.JimuFieldType.Date?(new Date).getUTCMilliseconds():"",a=t=>{const r=e.DataSourceManager.getInstance().getDataSource(t);return null!=r?r:void 0},u=(e,t)=>{var r;try{const i=null===(r=null==t?void 0:t.getSchema())||void 0===r?void 0:r.fields;if(i){for(const[,t]of Object.entries(i))if(t.alias===e)return[t.name,t.type];for(const[,t]of Object.entries(i))if(t.name===e)return[t.name,t.type]}return[void 0,void 0]}catch(e){return[void 0,void 0]}},s=e=>{let t=0;for(let r=0;r<e.length;r++)if(","===e[r]){if(1===t)return r}else"("===e[r]?t++:")"===e[r]&&t--;return-1},c=(t,n,o,c,d)=>r(void 0,void 0,void 0,(function*(){const f=parseFloat(t);if(!isNaN(f))return f;try{const f=t.substring(0,t.indexOf("("));if(["count","sum","min","max","avg","stddev","var","percentile_cont","percentile_disc"].includes(f)){const e=t.substring(t.indexOf("(")+1,t.indexOf(")")),o=void 0!==n?a(n[void 0!==d?d:0]):void 0;return yield((e,t,n)=>r(void 0,void 0,void 0,(function*(){const[r,o]=u(e,n);try{if(["count","sum","min","max","avg","stddev","var","percentile_cont","percentile_disc"].includes(t)){const e=(yield n.query({outStatistics:[{onStatisticField:r,outStatisticFieldName:"value",statisticType:t}]})).records[0].getFieldValue("value");return null==e?i(o):e}return console.error("Invalid aggregation function:",t),i(o)}catch(e){return console.error("Error fetching or aggregating data:",e),i(o)}})))(e,f,o)}return(e=>/^add\(.+\,.+\)$/.test(e)||/^sub\(.+\,.+\)$/.test(e)||/^mul\(.+\,.+\)$/.test(e)||/^div\(.+\,.+\)$/.test(e))(t)?yield((t,n,o,a,u)=>r(void 0,void 0,void 0,(function*(){try{const r=s(t),c=t.substring(0,t.indexOf("(")),d=t.substring(t.indexOf("(")+1,r),f=t.substring(r+1,t.length-1);let v=yield l(d,n,o,a,u),g=yield l(f,n,o,a,u);if("string"==typeof v&&(v=parseFloat(v)),"string"==typeof g&&(g=parseFloat(g)),isNaN(v)||isNaN(g))return i(e.JimuFieldType.Number);{let t=0;if("div"===c&&0===g)return i(e.JimuFieldType.Number);if("div"===c)t=v/g;else if("add"===c)t=v+g;else if("sub"===c)t=v-g;else{if("mul"!==c)return i(e.JimuFieldType.Number);t=v*g}return t}}catch(t){return console.error("Error dividing values:",t),i(e.JimuFieldType.Number)}})))(t,n,o,c,d):(e=>/^select\(.+\,.+\)$/.test(e))(t)?yield((t,n,o,a)=>r(void 0,void 0,void 0,(function*(){try{const r=s(t),u=parseFloat(t.substring(t.indexOf("(")+1,r));if(isNaN(u)||u<0||u>=n.length)return i(e.JimuFieldType.Number);const c=t.substring(r+1,t.length-1);return yield l(c,n,o,a,u)}catch(t){return console.error("Error selecting values:",t),i(e.JimuFieldType.Number)}})))(t,n,o,c):i(e.JimuFieldType.Number)}catch(t){return console.error("Error parsing function:",t),i(e.JimuFieldType.Number)}})),l=(t,n,o,s,l)=>r(void 0,void 0,void 0,(function*(){if((e=>/^.+\(.+\)$/.test(e))(t))return yield c(t,n,o,s,l);if((e=>/^\d+(\.\d+)?$/.test(e))(t))return parseFloat(t);try{const r=void 0!==n?a(n[void 0!==l?l:0]):void 0;return((t,r,n,o)=>{if(!r)return;let a=o?[o]:r.getSelectedRecords();const[s,c]=u(t,r);0===a.length&&(a=r.getRecords());try{if(!a||0===a.length||void 0===a[0]||null===a[0])return i(c);{const t=a[0].getFieldValue(s);if(null==t)return i(c);if(c!==e.JimuFieldType.Date)return c===e.JimuFieldType.Number?null!=t?t:i(c):t;{const e=new Date(t);if("toLocaleString"===n||void 0===n)return e.toLocaleString();if("toLocaleDateString"===n)return e.toLocaleDateString();if("toLocaleTimeString"===n)return e.toLocaleTimeString()}}}catch(e){return console.error("Error fetching data:",e),i(c)}})(t,r,o,s)}catch(t){return console.error("Error parsing function:",t),i(e.JimuFieldType.String)}})),d=(e,t,i,n,o,a,...u)=>r(void 0,[e,t,i,n,o,a,...u],void 0,(function*(e,t,r,i,n,o,a=!1){if(e.includes("{")&&e.includes("}")){const u=e.indexOf("{"),s=e.indexOf("}"),c=yield l(e.substring(u+1,s),t,r,n);let f=`${c}`;return"number"!=typeof c||a||(f=c.toLocaleString(o,{minimumFractionDigits:i,maximumFractionDigits:i})),e.substring(0,u)+f+(yield d(e.substring(s+1),t,r,i,n))}return e}));var f=function(e,t,r,i){return new(r||(r=Promise))((function(n,o){function a(e){try{s(i.next(e))}catch(e){o(e)}}function u(e){try{s(i.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,u)}s((i=i.apply(e,t||[])).next())}))};function v(r){var i;const[n,o]=(0,t.useState)(""),a=(0,t.useCallback)((e=>f(this,void 0,void 0,(function*(){return yield d(`dsId = ${e}, {value}`,[e])}))),[]),u=(0,t.useCallback)((()=>{var t;const i=e.DataSourceManager.getInstance().getDataSource(null===(t=r.outputDataSources)||void 0===t?void 0:t[0]);if(!i||void 0===r.config.urlParamName)return void o("Fail to create data. Reason: "+(i?void 0===r.config.urlParamName?"urlParamName not set":"isLoading is false":"Data source not created"));i.setStatus(e.DataSourceStatus.NotReady),i.setCountStatus(e.DataSourceStatus.NotReady);const n=new URLSearchParams(window.location.search).get(r.config.urlParamName),u=r.config.mapping.find((e=>e.key===n)),s=void 0!==u?u.value:r.config.defaultValue,c=i.buildRecord({attributes:{value:s}});i.setRecords([c]),i.setStatus(e.DataSourceStatus.Loaded),i.setCountStatus(e.DataSourceStatus.Loaded),i.getDataViews().forEach((e=>{var t;null===(t=e.setRecords)||void 0===t||t.call(e,[c])})),a(r.outputDataSources[0]).then((e=>{o(`Sum Records: ${e}`)})),o("Done!")}),[r.outputDataSources,r.config.urlParamName,r.config.mapping,r.config.defaultValue,a]);return(0,t.useEffect)((()=>{var t;(null===(t=r.outputDataSources)||void 0===t?void 0:t[0])?(o("Creating data source..."),e.DataSourceManager.getInstance().createDataSource(r.outputDataSources[0]).finally((()=>{o("Data source created"),u()}))):o("Please set the output data source in setting")}),[r.outputDataSources,u]),(0,e.jsx)("div",{className:"widget-demo jimu-widget m-2"},!(null===(i=r.outputDataSources)||void 0===i?void 0:i[0])&&(0,e.jsx)("h1",null,"Please set the output data source in setting"),n&&(0,e.jsx)("p",null,n))}function g(e){n.p=e}})(),o})())}}}));